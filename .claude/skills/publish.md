# publish

Zenn記事を公開するスキルです。品質チェックを行った後、公開状態に変更します。

**基本は予約公開を推奨します。** 読者の多い曜日・時間帯に合わせて公開することで、記事の到達率を高めます。

## 使い方

```
/publish                              # 予約公開（推奨日時を提案）
/publish --now                        # 即時公開
/publish --at "2026-01-21 07:00"      # 日時指定（JST）
/publish articles/my-article.md       # 記事パス指定
/publish articles/my-article.md --now # 記事パス＋即時公開
```

## 手順

1. **対象記事の確認**
   - 引数で記事パスが指定されていない場合、articles/配下の下書き記事（published: false）を一覧表示
   - ユーザーに公開する記事を選択してもらう

2. **自動チェックの実行**

   公開前に以下の3つのチェックを順番に実行します。

   ### Step 1: 炎上チェック（必須）

   ```
   /check-controversy を実行
   ```

   - 🔴 高リスクが検出された場合は**公開をブロック**
   - 修正が必要な箇所を具体的に提示
   - ユーザーが修正するまで次のステップに進まない

   ### Step 2: 記事レビュー（推奨）

   ```
   /review-article を実行
   ```

   - 6つの観点（読者視点、正確性、引用、構成、SEO、Zenn固有）でチェック
   - 改善提案を提示
   - 重大な問題がなければ次へ進む

   ### Step 3: 校正チェック（推奨）

   ```
   /proofread を実行
   ```

   - 誤字脱字、表記ゆれ、文法をチェック
   - 修正箇所を提示

3. **品質チェックリストの最終確認**

   ### 内容面
   - [ ] タイトルは内容を的確に表している
   - [ ] 導入部で「誰向けか」「何が得られるか」が明確
   - [ ] 具体的な例・コード・数値が含まれている
   - [ ] 結論・まとめが明確
   - [ ] 再現可能な手順になっている（技術記事の場合）

   ### 形式面
   - [ ] Front Matterが正しく設定されている
   - [ ] topicsは適切か（最大5つ、関連性のあるもの）
   - [ ] emojiは内容に合っている
   - [ ] コードブロックに言語指定がある

   ### SEO・読みやすさ
   - [ ] タイトルは60文字以内
   - [ ] 見出しの階層構造が適切（h2から開始）
   - [ ] 適度に見出しで区切られている

   ### 機密情報チェック
   - [ ] 社内の具体的なプロジェクト名・システム名が含まれていない
   - [ ] 顧客情報・個人情報が含まれていない
   - [ ] 公開可能なデータのみ使用している

4. **チェック結果のサマリー報告**

   ```markdown
   ## 公開前チェック結果

   | チェック項目 | 結果      | 詳細          |
   | ------------ | --------- | ------------- |
   | 炎上チェック | ✅ OK     | 高リスク: 0件 |
   | 記事レビュー | ⭐⭐⭐⭐☆ | 改善提案: 2件 |
   | 校正チェック | ✅ OK     | 修正: 0件     |

   **公開可能**: はい
   ```

   - 問題がある場合は具体的な修正提案を行う
   - ユーザーの確認を得る

5. **公開日時の決定**

   ### `--now` オプションがある場合

   即時公開に進む（Step 6へ）

   ### `--at` オプションがある場合

   指定された日時を使用する（日時確認後、Step 6へ）

   ### オプションなし（デフォルト）

   推奨日時を計算して提案する：

   #### 5-1. 現在日時の確認

   ```bash
   date "+%Y-%m-%d %H:%M (%a)"
   ```

   #### 5-2. 推奨公開日時の計算

   | 今日の曜日 | 次の公開日         |
   | ---------- | ------------------ |
   | 月曜       | 翌日（火曜）07:00  |
   | 火曜       | 翌日（水曜）07:00  |
   | 水曜       | 翌日（木曜）07:00  |
   | 木曜       | 翌日（金曜）07:00  |
   | 金曜       | 3日後（月曜）12:00 |
   | 土曜       | 2日後（月曜）12:00 |
   | 日曜       | 翌日（月曜）12:00  |

   **推奨理由:**
   - 月〜金曜: 平日は技術記事の閲覧が多い
   - 月曜12:00: 週初めの昼休み時間帯
   - 火〜金曜07:00: 通勤時間帯の情報収集需要

   #### 5-3. 祝日・休日チェック

   計算した日付が以下に該当しないか確認：
   - 日本の祝日（`.claude/rules/scheduled-publishing.md` 参照）
   - 年末年始（12/28〜1/3）
   - GW期間、お盆期間

   該当する場合は次の営業日（火〜木）にずらす。

   #### 5-4. 既存予約との重複チェック

   ```bash
   grep -l "published_at:" articles/*.md
   ```

   同日に他の記事が予約されている場合は、翌日以降を提案。

   #### 5-5. ユーザーへの提案

   ```markdown
   ## 公開日時の提案

   📅 **推奨公開日時**: 2026年1月21日（火）07:00 JST

   理由:

   - 火曜日は閲覧数がピークの曜日
   - 07:00 は通勤時間帯で技術記事の閲覧が多い

   この日時で予約しますか？

   1. はい、この日時で予約する
   2. 別の日時を指定する
   3. 今すぐ公開する
   ```

   #### 5-6. 日時確定前の最終確認

   :::message alert
   ⚠️ **重要**: `published_at` は一度設定すると**変更できません**

   間違えた場合は記事を削除して新しいslugで作り直す必要があります。
   :::

   ```
   📅 2026年1月21日（火）07:00 で予約します。

   この日時で間違いありませんか？ (yes/no)
   ```

   **必ず明示的な「yes」の回答を得てから次に進む。**

6. **公開処理**

   ### 即時公開の場合
   - `published: true` に変更
   - 変更をコミット（メッセージ例: `publish: 記事タイトル`）
   - `git push` でリモートに反映

   ### 予約公開の場合
   - `published: true` に変更
   - `published_at: "YYYY-MM-DD HH:MM"` を追加
   - 変更をコミット（メッセージ例: `publish(scheduled): 記事タイトル - 2026-01-21 07:00`）
   - `git push` でリモートに反映

   ```yaml
   # 予約公開時のFront Matter例
   ---
   title: "記事タイトル"
   emoji: "🤖"
   type: "tech"
   topics: ["claude", "ai"]
   published: true
   published_at: "2026-01-21 07:00"
   ---
   ```

7. **公開後の案内**

   ### 即時公開の場合
   - 記事URL: `https://zenn.dev/ユーザー名/articles/slug`
   - 反映には数分かかる場合がある旨を説明

   ### 予約公開の場合

   ```markdown
   ✅ 予約公開を設定しました

   - 📅 公開予定: 2026年1月21日（火）07:00 JST
   - 🔗 公開後URL: https://zenn.dev/ユーザー名/articles/slug
   - 📝 公開前に内容を編集することは可能です

   ⚠️ 注意: `published_at` の日時は変更できません。
   日時を変更したい場合は記事を削除して作り直してください。
   ```

---

## 注意事項

### published_at の制約

:::message alert
**`published_at` は一度設定すると変更できません。**

これはZennの仕様です。設定前に必ず日時を確認してください。
:::

### 間違えた場合のリカバリー

#### 公開前（push前）

```bash
# Front Matterを直接編集してpublished_atを修正
```

#### 公開予約済み（push後）

```bash
# 1. 間違えた記事を削除
rm articles/間違えた記事.md

# 2. 新しいslugで記事を作成
npx zenn-cli new:article --slug 新しいslug

# 3. 内容をコピーして正しいpublished_atを設定

# 4. コミット＆プッシュ
git add .
git commit -m "fix: 記事の予約日時を修正（新slug）"
git push
```

### その他

- 公開後もFront Matterを編集すれば内容は更新される
- slugを変更するとURLが変わるので注意
- 一度公開した記事を非公開にする場合は `published: false` に戻す

---

## 関連スキル

- `/check-controversy` - 炎上リスクチェック
- `/review-article` - 記事品質レビュー
- `/proofread` - 校正チェック
- `/preview` - プレビュー確認

## 関連ルール

- `.claude/rules/scheduled-publishing.md` - 予約公開のルール
- `.claude/rules/pre-publish-checklist.md` - 公開前チェックリスト
